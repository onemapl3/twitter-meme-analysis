<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸš€ Memeå¸åˆ†æå¹³å°</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root {
            --primary-color: #6366f1;
            --secondary-color: #8b5cf6;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --dark-color: #1f2937;
            --light-color: #f8fafc;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .navbar {
            background: rgba(255, 255, 255, 0.1) !important;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .navbar-brand {
            font-weight: bold;
            font-size: 1.5rem;
        }
        
        .main-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            margin: 2rem auto;
            padding: 2rem;
            backdrop-filter: blur(10px);
        }
        
        .stats-card {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        
        .stats-card:hover {
            transform: translateY(-5px);
        }
        
        .stats-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .stats-label {
            font-size: 1rem;
            opacity: 0.9;
        }
        
        .search-box {
            background: white;
            border-radius: 25px;
            padding: 1rem 1.5rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }
        
        .search-input {
            border: none;
            outline: none;
            width: 100%;
            font-size: 1.1rem;
        }
        
        .filter-section {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .meme-card {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border-left: 4px solid var(--primary-color);
        }
        
        .meme-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }
        
        .meme-symbol {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .meme-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--dark-color);
            margin-bottom: 0.5rem;
        }
        
        .meme-category {
            display: inline-block;
            background: var(--light-color);
            color: var(--dark-color);
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-bottom: 0.5rem;
        }
        
        .meme-stats {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .stat-label {
            font-size: 0.8rem;
            color: #6b7280;
        }
        
        .loading {
            text-align: center;
            padding: 2rem;
            color: #6b7280;
        }
        
        .error {
            background: #fef2f2;
            color: #dc2626;
            padding: 1rem;
            border-radius: 10px;
            margin: 1rem 0;
        }
        
        .pagination {
            justify-content: center;
            margin-top: 2rem;
        }
        
        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .btn-custom {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border: none;
            border-radius: 25px;
            padding: 0.5rem 1.5rem;
            color: white;
            font-weight: 600;
            transition: transform 0.3s ease;
        }
        
        .btn-custom:hover {
            transform: translateY(-2px);
            color: white;
        }
        
        .footer {
            text-align: center;
            padding: 2rem;
            color: rgba(255, 255, 255, 0.8);
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-rocket"></i> Memeå¸åˆ†æå¹³å°
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="#overview">æ¦‚è§ˆ</a>
                <a class="nav-link" href="#memes">Memeå¸</a>
                <a class="nav-link" href="#kol">KOLåˆ†æ</a>
                <a class="nav-link" href="#about">å…³äº</a>
            </div>
        </div>
    </nav>

    <div class="container">
        <!-- ä¸»å®¹å™¨ -->
        <div class="main-container">
            <!-- æ¦‚è§ˆç»Ÿè®¡ -->
            <section id="overview">
                <h2 class="text-center mb-4">
                    <i class="fas fa-chart-line"></i> å¸‚åœºæ¦‚è§ˆ
                </h2>
                <div class="row" id="overview-stats">
                    <div class="col-md-3">
                        <div class="stats-card text-center">
                            <div class="stats-number" id="total-memes">-</div>
                            <div class="stats-label">æ€»Memeå¸</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stats-card text-center">
                            <div class="stats-number" id="known-memes">-</div>
                            <div class="stats-label">å·²çŸ¥é¡¹ç›®</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stats-card text-center">
                            <div class="stats-number" id="potential-memes">-</div>
                            <div class="stats-label">æ½œåœ¨å‘ç°</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stats-card text-center">
                            <div class="stats-number" id="total-mentions">-</div>
                            <div class="stats-label">æ€»æåŠæ¬¡æ•°</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- æœç´¢å’Œç­›é€‰ -->
            <section id="search-filter">
                <div class="search-box">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <input type="text" class="search-input" id="search-input" 
                                   placeholder="ğŸ” æœç´¢memeå¸åç§°ã€ç¬¦å·æˆ–æè¿°...">
                        </div>
                        <div class="col-md-4 text-end">
                            <button class="btn btn-custom" onclick="searchMemes()">
                                <i class="fas fa-search"></i> æœç´¢
                            </button>
                        </div>
                    </div>
                </div>

                <div class="filter-section">
                    <div class="row">
                        <div class="col-md-3">
                            <label class="form-label">åˆ†ç±»ç­›é€‰</label>
                            <select class="form-select" id="category-filter">
                                <option value="">æ‰€æœ‰åˆ†ç±»</option>
                                <option value="ai_meme">AIä¸»é¢˜</option>
                                <option value="animal_meme">åŠ¨ç‰©ä¸»é¢˜</option>
                                <option value="internet_culture">ç½‘ç»œæ–‡åŒ–</option>
                                <option value="community_meme">ç¤¾åŒºé©±åŠ¨</option>
                                <option value="potential_meme">æ½œåœ¨é¡¹ç›®</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">æ’åºæ–¹å¼</label>
                            <select class="form-select" id="sort-filter">
                                <option value="total_score">çƒ­åº¦åˆ†æ•°</option>
                                <option value="mention_count">æåŠæ¬¡æ•°</option>
                                <option value="unique_users">ç”¨æˆ·æ•°é‡</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">æ¯é¡µæ˜¾ç¤º</label>
                            <select class="form-select" id="limit-filter">
                                <option value="10">10æ¡</option>
                                <option value="20">20æ¡</option>
                                <option value="50" selected>50æ¡</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">&nbsp;</label>
                            <button class="btn btn-custom w-100" onclick="applyFilters()">
                                <i class="fas fa-filter"></i> åº”ç”¨ç­›é€‰
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Memeå¸åˆ—è¡¨ -->
            <section id="memes">
                <h3 class="mb-3">
                    <i class="fas fa-coins"></i> Memeå¸åˆ—è¡¨
                </h3>
                <div id="memes-container">
                    <div class="loading">
                        <i class="fas fa-spinner fa-spin"></i> åŠ è½½ä¸­...
                    </div>
                </div>
                <div id="pagination-container"></div>
            </section>

            <!-- å›¾è¡¨åˆ†æ -->
            <section id="charts">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h3>
                        <i class="fas fa-chart-pie"></i> æ•°æ®åˆ†æ
                    </h3>
                    <div class="btn-group" role="group">
                        <button type="button" class="btn btn-outline-primary btn-sm" onclick="refreshCharts()">
                            <i class="fas fa-sync-alt"></i> åˆ·æ–°å›¾è¡¨
                        </button>
                        <button type="button" class="btn btn-outline-secondary btn-sm" onclick="exportChartData()">
                            <i class="fas fa-download"></i> å¯¼å‡ºæ•°æ®
                        </button>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="chart-container">
                            <h5>åˆ†ç±»åˆ†å¸ƒ</h5>
                            <canvas id="categoryChart"></canvas>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="chart-container">
                            <h5>çƒ­åº¦åˆ†å¸ƒ</h5>
                            <canvas id="scoreChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- æ–°å¢ç»Ÿè®¡å›¾è¡¨ -->
                <div class="row mt-4">
                    <div class="col-md-6">
                        <div class="chart-container">
                            <h5>Top Memeå¸çƒ­åº¦å¯¹æ¯”</h5>
                            <canvas id="topMemesChart"></canvas>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="chart-container">
                            <h5>ç”¨æˆ·å‚ä¸åº¦åˆ†æ</h5>
                            <canvas id="engagementChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="row mt-4">
                    <div class="col-md-6">
                        <div class="chart-container">
                            <h5>Memeå¸çƒ­åº¦è¶‹åŠ¿é›·è¾¾å›¾</h5>
                            <canvas id="radarChart"></canvas>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="chart-container">
                            <h5>æ£€æµ‹ç±»å‹åˆ†å¸ƒ</h5>
                            <canvas id="detectionTypeChart"></canvas>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="chart-container">
                            <h5>çƒ­åº¦è¶‹åŠ¿åˆ†æ</h5>
                            <canvas id="trendChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- æ–°å¢è¶‹åŠ¿åˆ†æå›¾è¡¨ -->
                <div class="row mt-4">
                    <div class="col-md-12">
                        <div class="chart-container">
                            <h5>Memeå¸çƒ­åº¦è¶‹åŠ¿æ—¶é—´çº¿</h5>
                            <canvas id="timelineChart"></canvas>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- é¡µè„š -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2024 Memeå¸åˆ†æå¹³å°. åŸºäºTwitteræ•°æ®åˆ†æçš„æ™ºèƒ½memeå¸å‘ç°ç³»ç»Ÿ.</p>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // å…¨å±€å˜é‡
        let currentPage = 0;
        let currentLimit = 50;
        let currentCategory = '';
        let currentSortBy = 'total_score';
        let allMemes = [];
        let filteredMemes = [];

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadOverview();
            loadMemes();
            loadCategories();
            
            // è®¾ç½®å®šæ—¶åˆ·æ–°ï¼ˆæ¯5åˆ†é’Ÿï¼‰
            setInterval(() => {
                loadOverview();
                loadMemes();
            }, 5 * 60 * 1000);
        });

        // åŠ è½½æ¦‚è§ˆæ•°æ®
        async function loadOverview() {
            try {
                const response = await fetch('/api/memes/overview');
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                document.getElementById('total-memes').textContent = data.total_memes;
                document.getElementById('known-memes').textContent = data.known_memes;
                document.getElementById('potential-memes').textContent = data.potential_memes;
                document.getElementById('total-mentions').textContent = data.total_mentions.toLocaleString();
                
            } catch (error) {
                console.error('åŠ è½½æ¦‚è§ˆå¤±è´¥:', error);
                showError('åŠ è½½æ¦‚è§ˆæ•°æ®å¤±è´¥');
            }
        }

        // åŠ è½½Memeå¸åˆ—è¡¨
        async function loadMemes() {
            try {
                // æ„å»ºAPI URLï¼Œå¤„ç†ç©ºåˆ†ç±»å‚æ•°
                let url = `/api/memes?limit=${currentLimit}&offset=${currentPage * currentLimit}&sort_by=${currentSortBy}`;
                if (currentCategory && currentCategory.trim() !== '') {
                    url += `&category=${currentCategory}`;
                }
                
                console.log('è¯·æ±‚URL:', url);
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                allMemes = data.data;
                filteredMemes = data.data;
                displayMemes();
                displayPagination(data.pagination);
                
                // åˆ›å»ºå›¾è¡¨ï¼ˆæ·»åŠ é”™è¯¯å¤„ç†ï¼‰
                try {
                    createScoreChart(allMemes);
                    createTopMemesChart(allMemes);
                    createEngagementChart(allMemes);
                    createRadarChart(allMemes);
                    createDetectionTypeChart(allMemes);
                    createTrendChart(allMemes);
                    createTimelineChart(allMemes);
                } catch (chartError) {
                    console.warn('éƒ¨åˆ†å›¾è¡¨åˆ›å»ºå¤±è´¥:', chartError);
                    // å›¾è¡¨åˆ›å»ºå¤±è´¥ä¸å½±å“ä¸»è¦åŠŸèƒ½
                }
                
            } catch (error) {
                console.error('åŠ è½½Memeå¸åˆ—è¡¨å¤±è´¥:', error);
                showError(`åŠ è½½Memeå¸åˆ—è¡¨å¤±è´¥: ${error.message}`);
            }
        }

        // åŠ è½½åˆ†ç±»ç»Ÿè®¡
        async function loadCategories() {
            try {
                const response = await fetch('/api/memes/categories');
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                createCategoryChart(data);
                
            } catch (error) {
                console.error('åŠ è½½åˆ†ç±»ç»Ÿè®¡å¤±è´¥:', error);
            }
        }

        // æ˜¾ç¤ºMemeå¸åˆ—è¡¨
        function displayMemes() {
            const container = document.getElementById('memes-container');
            
            if (filteredMemes.length === 0) {
                container.innerHTML = '<div class="text-center text-muted">æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„memeå¸</div>';
                return;
            }
            
            let html = '';
            filteredMemes.forEach(meme => {
                html += `
                    <div class="meme-card">
                        <div class="row align-items-center">
                            <div class="col-md-3">
                                <div class="meme-symbol">${meme.symbol}</div>
                                <div class="meme-name">${meme.name}</div>
                                <span class="meme-category">${formatCategory(meme.category)}</span>
                            </div>
                            <div class="col-md-6">
                                <div class="meme-stats">
                                    <div class="stat-item">
                                        <div class="stat-value">${meme.total_score.toFixed(1)}</div>
                                        <div class="stat-label">çƒ­åº¦åˆ†æ•°</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value">${meme.mention_count}</div>
                                        <div class="stat-label">æåŠæ¬¡æ•°</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value">${meme.unique_users}</div>
                                        <div class="stat-label">ç”¨æˆ·æ•°é‡</div>
                                    </div>
                                </div>
                                <p class="text-muted mb-0">${meme.description || 'æš‚æ— æè¿°'}</p>
                            </div>
                            <div class="col-md-3 text-end">
                                <button class="btn btn-outline-primary btn-sm" onclick="viewMemeDetail('${meme.id}')">
                                    <i class="fas fa-eye"></i> æŸ¥çœ‹è¯¦æƒ…
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // æ˜¾ç¤ºåˆ†é¡µ
        function displayPagination(pagination) {
            const container = document.getElementById('pagination-container');
            
            if (pagination.total <= pagination.limit) {
                container.innerHTML = '';
                return;
            }
            
            const totalPages = Math.ceil(pagination.total / pagination.limit);
            let html = '<nav><ul class="pagination">';
            
            // ä¸Šä¸€é¡µ
            html += `<li class="page-item ${currentPage === 0 ? 'disabled' : ''}">
                        <a class="page-link" href="#" onclick="changePage(${currentPage - 1})">ä¸Šä¸€é¡µ</a>
                     </li>`;
            
            // é¡µç 
            for (let i = 0; i < totalPages; i++) {
                if (i === currentPage) {
                    html += `<li class="page-item active"><span class="page-link">${i + 1}</span></li>`;
                } else {
                    html += `<li class="page-item"><a class="page-link" href="#" onclick="changePage(${i})">${i + 1}</a></li>`;
                }
            }
            
            // ä¸‹ä¸€é¡µ
            html += `<li class="page-item ${currentPage >= totalPages - 1 ? 'disabled' : ''}">
                        <a class="page-link" href="#" onclick="changePage(${currentPage + 1})">ä¸‹ä¸€é¡µ</a>
                     </li>`;
            
            html += '</ul></nav>';
            container.innerHTML = html;
        }

        // æœç´¢Memeå¸
        async function searchMemes() {
            const query = document.getElementById('search-input').value.trim();
            
            if (!query) {
                loadMemes();
                return;
            }
            
            try {
                const response = await fetch(`/api/search?q=${encodeURIComponent(query)}&limit=50`);
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                filteredMemes = data.results;
                currentPage = 0;
                displayMemes();
                
                // æ¸…ç©ºåˆ†é¡µ
                document.getElementById('pagination-container').innerHTML = '';
                
            } catch (error) {
                console.error('æœç´¢å¤±è´¥:', error);
                showError('æœç´¢å¤±è´¥');
            }
        }

        // åº”ç”¨ç­›é€‰
        function applyFilters() {
            currentCategory = document.getElementById('category-filter').value;
            currentSortBy = document.getElementById('sort-filter').value;
            currentLimit = parseInt(document.getElementById('limit-filter').value);
            currentPage = 0;
            
            console.log('åº”ç”¨ç­›é€‰:', {
                category: currentCategory,
                sortBy: currentSortBy,
                limit: currentLimit,
                page: currentPage
            });
            
            loadMemes();
        }

        // åˆ‡æ¢é¡µé¢
        function changePage(page) {
            currentPage = page;
            loadMemes();
        }

        // æŸ¥çœ‹Memeå¸è¯¦æƒ…
        function viewMemeDetail(memeId) {
            // è¿™é‡Œå¯ä»¥å®ç°æ¨¡æ€æ¡†æ˜¾ç¤ºè¯¦æƒ…
            alert(`æŸ¥çœ‹ ${memeId} çš„è¯¦ç»†ä¿¡æ¯`);
        }

        // åˆ›å»ºåˆ†ç±»å›¾è¡¨
        function createCategoryChart(categoryData) {
            const ctx = document.getElementById('categoryChart').getContext('2d');
            
            const labels = Object.keys(categoryData).map(cat => formatCategory(cat));
            const data = Object.values(categoryData).map(cat => cat.count);
            const colors = [
                '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FECA57'
            ];
            
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors,
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }
        
        // åˆ›å»ºçƒ­åº¦åˆ†å¸ƒå›¾è¡¨
        function createScoreChart(memes) {
            const ctx = document.getElementById('scoreChart').getContext('2d');
            
            // æŒ‰åˆ†æ•°åˆ†ç»„
            const scoreRanges = {
                '0-50': 0,
                '51-100': 0,
                '101-200': 0,
                '201-300': 0,
                '300+': 0
            };
            
            memes.forEach(meme => {
                const score = meme.total_score;
                if (score <= 50) scoreRanges['0-50']++;
                else if (score <= 100) scoreRanges['51-100']++;
                else if (score <= 200) scoreRanges['101-200']++;
                else if (score <= 300) scoreRanges['201-300']++;
                else scoreRanges['300+']++;
            });
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(scoreRanges),
                    datasets: [{
                        label: 'Memeå¸æ•°é‡',
                        data: Object.values(scoreRanges),
                        backgroundColor: 'rgba(99, 102, 241, 0.8)',
                        borderColor: 'rgba(99, 102, 241, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }
        
        // åˆ›å»ºTop Memeå¸çƒ­åº¦å¯¹æ¯”å›¾è¡¨
        function createTopMemesChart(memes) {
            const ctx = document.getElementById('topMemesChart').getContext('2d');
            
            // å–å‰10å
            const topMemes = memes.slice(0, 10);
            const labels = topMemes.map(meme => meme.symbol);
            const scores = topMemes.map(meme => meme.total_score);
            const mentions = topMemes.map(meme => meme.mention_count);
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'çƒ­åº¦åˆ†æ•°',
                            data: scores,
                            backgroundColor: 'rgba(139, 92, 246, 0.8)',
                            borderColor: 'rgba(139, 92, 246, 1)',
                            borderWidth: 2,
                            yAxisID: 'y'
                        },
                        {
                            label: 'æåŠæ¬¡æ•°',
                            data: mentions,
                            backgroundColor: 'rgba(16, 185, 129, 0.8)',
                            borderColor: 'rgba(16, 185, 129, 1)',
                            borderWidth: 2,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        legend: {
                            position: 'top'
                        }
                    },
                    scales: {
                        x: {
                            display: true,
                            title: {
                                display: true,
                                text: 'Memeå¸'
                            }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'çƒ­åº¦åˆ†æ•°'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'æåŠæ¬¡æ•°'
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                        }
                    }
                }
            });
        }
        
        // åˆ›å»ºç”¨æˆ·å‚ä¸åº¦åˆ†æå›¾è¡¨
        function createEngagementChart(memes) {
            const ctx = document.getElementById('engagementChart').getContext('2d');
            
            // è®¡ç®—å‚ä¸åº¦æŒ‡æ ‡
            const engagementData = memes.map(meme => ({
                symbol: meme.symbol,
                engagement_rate: meme.mention_count > 0 ? meme.unique_users / meme.mention_count : 0,
                user_diversity: meme.unique_users,
                mention_intensity: meme.mention_count
            }));
            
            // æŒ‰å‚ä¸åº¦æ’åºï¼Œå–å‰15å
            engagementData.sort((a, b) => b.engagement_rate - a.engagement_rate);
            const topEngagement = engagementData.slice(0, 15);
            
            new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'ç”¨æˆ·å‚ä¸åº¦ vs æåŠå¼ºåº¦',
                        data: topEngagement.map(item => ({
                            x: item.mention_intensity,
                            y: item.engagement_rate,
                            r: Math.min(item.user_diversity / 2, 20) // æ°”æ³¡å¤§å°åŸºäºç”¨æˆ·å¤šæ ·æ€§
                        })),
                        backgroundColor: 'rgba(245, 158, 11, 0.6)',
                        borderColor: 'rgba(245, 158, 11, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const item = topEngagement[context.dataIndex];
                                    return `${item.symbol}: å‚ä¸åº¦=${context.parsed.y.toFixed(3)}, æåŠ=${context.parsed.x}, ç”¨æˆ·=${item.user_diversity}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'æåŠæ¬¡æ•°'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'ç”¨æˆ·å‚ä¸åº¦ (ç”¨æˆ·æ•°/æåŠæ•°)'
                            }
                        }
                    }
                }
            });
        }
        
        // åˆ›å»ºé›·è¾¾å›¾
        function createRadarChart(memes) {
            const ctx = document.getElementById('radarChart').getContext('2d');
            
            // é€‰æ‹©å‰8ä¸ªmemeå¸è¿›è¡Œé›·è¾¾å›¾åˆ†æ
            const topMemes = memes.slice(0, 8);
            
            const datasets = topMemes.map((meme, index) => {
                const colors = [
                    'rgba(99, 102, 241, 0.6)',
                    'rgba(139, 92, 246, 0.6)',
                    'rgba(16, 185, 129, 0.6)',
                    'rgba(245, 158, 11, 0.6)',
                    'rgba(239, 68, 68, 0.6)',
                    'rgba(236, 72, 153, 0.6)',
                    'rgba(14, 165, 233, 0.6)',
                    'rgba(34, 197, 94, 0.6)'
                ];
                
                return {
                    label: meme.symbol,
                    data: [
                        normalizeScore(meme.total_score, 0, 400), // çƒ­åº¦åˆ†æ•°
                        normalizeScore(meme.mention_count, 0, 1000), // æåŠæ¬¡æ•°
                        normalizeScore(meme.unique_users, 0, 100), // ç”¨æˆ·æ•°é‡
                        normalizeScore(meme.total_score / (meme.mention_count || 1), 0, 10), // æ•ˆç‡åˆ†æ•°
                        normalizeScore(meme.unique_users / (meme.mention_count || 1), 0, 1) // ç”¨æˆ·å‚ä¸åº¦
                    ],
                    backgroundColor: colors[index],
                    borderColor: colors[index].replace('0.6', '1'),
                    borderWidth: 2,
                    pointBackgroundColor: colors[index].replace('0.6', '1'),
                    pointBorderColor: '#fff',
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: colors[index].replace('0.6', '1')
                };
            });
            
            new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['çƒ­åº¦åˆ†æ•°', 'æåŠæ¬¡æ•°', 'ç”¨æˆ·æ•°é‡', 'æ•ˆç‡åˆ†æ•°', 'ç”¨æˆ·å‚ä¸åº¦'],
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                usePointStyle: true,
                                padding: 15
                            }
                        }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                stepSize: 20
                            }
                        }
                    }
                }
            });
        }
        
        // åˆ›å»ºæ£€æµ‹ç±»å‹åˆ†å¸ƒå›¾è¡¨
        function createDetectionTypeChart(memes) {
            const ctx = document.getElementById('detectionTypeChart').getContext('2d');
            
            const typeCounts = {};
            memes.forEach(meme => {
                const type = meme.detection_type;
                typeCounts[type] = (typeCounts[type] || 0) + 1;
            });
            
            const labels = Object.keys(typeCounts).map(type => 
                type === 'known_meme' ? 'å·²çŸ¥é¡¹ç›®' : 'æ½œåœ¨å‘ç°'
            );
            const data = Object.values(typeCounts);
            const colors = ['rgba(16, 185, 129, 0.8)', 'rgba(245, 158, 11, 0.8)'];
            
            new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors,
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }
        
        // è¾…åŠ©å‡½æ•°ï¼šæ ‡å‡†åŒ–åˆ†æ•°åˆ°0-100èŒƒå›´
        function normalizeScore(score, min, max) {
            return Math.min(100, Math.max(0, ((score - min) / (max - min)) * 100));
        }
        
        // åˆ›å»ºçƒ­åº¦è¶‹åŠ¿åˆ†æå›¾è¡¨
        function createTrendChart(memes) {
            const ctx = document.getElementById('trendChart').getContext('2d');
            
            // æŒ‰åˆ†ç±»ç»Ÿè®¡å¹³å‡çƒ­åº¦
            const categoryTrends = {};
            memes.forEach(meme => {
                const category = meme.category;
                if (!categoryTrends[category]) {
                    categoryTrends[category] = {
                        total_score: 0,
                        count: 0,
                        avg_mentions: 0,
                        total_mentions: 0
                    };
                }
                categoryTrends[category].total_score += meme.total_score;
                categoryTrends[category].count += 1;
                categoryTrends[category].total_mentions += meme.mention_count;
            });
            
            // è®¡ç®—å¹³å‡å€¼
            Object.keys(categoryTrends).forEach(category => {
                const data = categoryTrends[category];
                data.avg_score = data.total_score / data.count;
                data.avg_mentions = data.total_mentions / data.count;
            });
            
            const labels = Object.keys(categoryTrends).map(cat => formatCategory(cat));
            const avgScores = Object.values(categoryTrends).map(data => data.avg_score);
            const avgMentions = Object.values(categoryTrends).map(data => data.avg_mentions);
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'å¹³å‡çƒ­åº¦åˆ†æ•°',
                            data: avgScores,
                            borderColor: 'rgba(99, 102, 241, 1)',
                            backgroundColor: 'rgba(99, 102, 241, 0.1)',
                            tension: 0.4,
                            fill: true
                        },
                        {
                            label: 'å¹³å‡æåŠæ¬¡æ•°',
                            data: avgMentions,
                            borderColor: 'rgba(16, 185, 129, 1)',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            tension: 0.4,
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                usePointStyle: true
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        
        // åˆ›å»ºæ—¶é—´çº¿è¶‹åŠ¿å›¾è¡¨
        function createTimelineChart(memes) {
            const ctx = document.getElementById('timelineChart').getContext('2d');
            
            // æŒ‰æˆç«‹æ—¶é—´åˆ†ç»„
            const timelineData = {};
            memes.forEach(meme => {
                const year = meme.founded;
                if (!timelineData[year]) {
                    timelineData[year] = {
                        count: 0,
                        total_score: 0,
                        total_mentions: 0
                    };
                }
                timelineData[year].count += 1;
                timelineData[year].total_score += meme.total_score;
                timelineData[year].total_mentions += meme.mention_count;
            });
            
            // æŒ‰å¹´ä»½æ’åº
            const sortedYears = Object.keys(timelineData).sort();
            const counts = sortedYears.map(year => timelineData[year].count);
            const avgScores = sortedYears.map(year => timelineData[year].total_score / timelineData[year].count);
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sortedYears,
                    datasets: [
                        {
                            label: 'é¡¹ç›®æ•°é‡',
                            data: counts,
                            backgroundColor: 'rgba(139, 92, 246, 0.8)',
                            borderColor: 'rgba(139, 92, 246, 1)',
                            borderWidth: 2,
                            yAxisID: 'y'
                        },
                        {
                            label: 'å¹³å‡çƒ­åº¦åˆ†æ•°',
                            data: avgScores,
                            backgroundColor: 'rgba(16, 185, 129, 0.8)',
                            borderColor: 'rgba(16, 185, 129, 1)',
                            borderWidth: 2,
                            yAxisID: 'y1',
                            type: 'line'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        legend: {
                            position: 'top'
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'æˆç«‹å¹´ä»½'
                            }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'é¡¹ç›®æ•°é‡'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'å¹³å‡çƒ­åº¦åˆ†æ•°'
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                        }
                    }
                }
            });
        }

        // æ ¼å¼åŒ–åˆ†ç±»åç§°
        function formatCategory(category) {
            const categoryMap = {
                'ai_meme': 'AIä¸»é¢˜',
                'animal_meme': 'åŠ¨ç‰©ä¸»é¢˜',
                'internet_culture': 'ç½‘ç»œæ–‡åŒ–',
                'community_meme': 'ç¤¾åŒºé©±åŠ¨',
                'potential_meme': 'æ½œåœ¨é¡¹ç›®'
            };
            return categoryMap[category] || category;
        }

        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        function showError(message) {
            const container = document.getElementById('memes-container');
            container.innerHTML = `<div class="error"><i class="fas fa-exclamation-triangle"></i> ${message}</div>`;
        }

        // å›è½¦æœç´¢
        document.getElementById('search-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchMemes();
            }
        });
        
        // åˆ·æ–°å›¾è¡¨
        function refreshCharts() {
            loadMemes();
            loadCategories();
        }
        
        // å¯¼å‡ºå›¾è¡¨æ•°æ®
        function exportChartData() {
            if (allMemes.length === 0) {
                alert('æš‚æ— æ•°æ®å¯å¯¼å‡º');
                return;
            }
            
            // å‡†å¤‡å¯¼å‡ºæ•°æ®
            const exportData = {
                export_timestamp: new Date().toISOString(),
                total_memes: allMemes.length,
                meme_data: allMemes.map(meme => ({
                    symbol: meme.symbol,
                    name: meme.name,
                    category: meme.category,
                    total_score: meme.total_score,
                    mention_count: meme.mention_count,
                    unique_users: meme.unique_users,
                    founded: meme.founded,
                    detection_type: meme.detection_type
                })),
                statistics: {
                    categories: Object.fromEntries(
                        Object.entries(
                            allMemes.reduce((acc, meme) => {
                                acc[meme.category] = (acc[meme.category] || 0) + 1;
                                return acc;
                            }, {})
                        )
                    ),
                    detection_types: Object.fromEntries(
                        Object.entries(
                            allMemes.reduce((acc, meme) => {
                                acc[meme.detection_type] = (acc[meme.detection_type] || 0) + 1;
                                return acc;
                            }, {})
                        )
                    )
                }
            };
            
            // åˆ›å»ºä¸‹è½½é“¾æ¥
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `meme_analysis_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
