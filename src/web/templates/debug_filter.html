<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç­›é€‰åŠŸèƒ½è°ƒè¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .error { color: red; }
        .success { color: green; }
        button { margin: 5px; padding: 10px; }
        select { margin: 5px; padding: 5px; }
    </style>
</head>
<body>
    <h1>ğŸ” ç­›é€‰åŠŸèƒ½è°ƒè¯•é¡µé¢</h1>
    
    <div class="debug-section">
        <h3>ç­›é€‰å™¨è®¾ç½®</h3>
        <label>åˆ†ç±»ç­›é€‰:</label>
        <select id="category-filter">
            <option value="">æ‰€æœ‰åˆ†ç±»</option>
            <option value="ai_meme">AIä¸»é¢˜</option>
            <option value="animal_meme">åŠ¨ç‰©ä¸»é¢˜</option>
            <option value="internet_culture">ç½‘ç»œæ–‡åŒ–</option>
            <option value="community_meme">ç¤¾åŒºé©±åŠ¨</option>
            <option value="potential_meme">æ½œåœ¨é¡¹ç›®</option>
        </select>
        
        <label>æ’åºæ–¹å¼:</label>
        <select id="sort-filter">
            <option value="total_score">çƒ­åº¦åˆ†æ•°</option>
            <option value="mention_count">æåŠæ¬¡æ•°</option>
            <option value="unique_users">ç”¨æˆ·æ•°é‡</option>
        </select>
        
        <label>æ¯é¡µæ˜¾ç¤º:</label>
        <select id="limit-filter">
            <option value="10">10æ¡</option>
            <option value="20">20æ¡</option>
            <option value="50" selected>50æ¡</option>
        </select>
        
        <button onclick="testFilter()">æµ‹è¯•ç­›é€‰</button>
        <button onclick="testAllCategories()">æµ‹è¯•æ‰€æœ‰åˆ†ç±»</button>
    </div>
    
    <div class="debug-section">
        <h3>APIæµ‹è¯•ç»“æœ</h3>
        <div id="api-result"></div>
    </div>
    
    <div class="debug-section">
        <h3>æ§åˆ¶å°æ—¥å¿—</h3>
        <div id="console-log"></div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let currentPage = 0;
        let currentLimit = 50;
        let currentCategory = '';
        let currentSortBy = 'total_score';
        
        // é‡å†™console.logæ¥æ˜¾ç¤ºåœ¨é¡µé¢ä¸Š
        const originalLog = console.log;
        const originalError = console.error;
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            document.getElementById('console-log').innerHTML += `<div class="success">LOG: ${args.join(' ')}</div>`;
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            document.getElementById('console-log').innerHTML += `<div class="error">ERROR: ${args.join(' ')}</div>`;
        };
        
        // æµ‹è¯•ç­›é€‰åŠŸèƒ½
        async function testFilter() {
            currentCategory = document.getElementById('category-filter').value;
            currentSortBy = document.getElementById('sort-filter').value;
            currentLimit = parseInt(document.getElementById('limit-filter').value);
            
            console.log('ç­›é€‰å‚æ•°:', {
                category: currentCategory,
                sortBy: currentSortBy,
                limit: currentLimit,
                page: currentPage
            });
            
            try {
                const url = `/api/memes?limit=${currentLimit}&offset=${currentPage * currentLimit}&category=${currentCategory}&sort_by=${currentSortBy}`;
                console.log('è¯·æ±‚URL:', url);
                
                const response = await fetch(url);
                console.log('å“åº”çŠ¶æ€:', response.status);
                
                const data = await response.json();
                console.log('å“åº”æ•°æ®:', data);
                
                if (data.error) {
                    document.getElementById('api-result').innerHTML = `<div class="error">APIé”™è¯¯: ${data.error}</div>`;
                } else {
                    document.getElementById('api-result').innerHTML = `
                        <div class="success">
                            <h4>ç­›é€‰æˆåŠŸ!</h4>
                            <p>æ‰¾åˆ° ${data.data.length} æ¡è®°å½•</p>
                            <p>æ€»è®¡: ${data.pagination.total} æ¡</p>
                            <p>åˆ†ç±»: ${currentCategory || 'æ‰€æœ‰åˆ†ç±»'}</p>
                            <p>æ’åº: ${currentSortBy}</p>
                        </div>
                    `;
                }
                
            } catch (error) {
                console.error('ç­›é€‰æµ‹è¯•å¤±è´¥:', error);
                document.getElementById('api-result').innerHTML = `<div class="error">è¯·æ±‚å¤±è´¥: ${error.message}</div>`;
            }
        }
        
        // æµ‹è¯•æ‰€æœ‰åˆ†ç±»
        async function testAllCategories() {
            const categories = ['', 'ai_meme', 'animal_meme', 'internet_culture', 'community_meme', 'potential_meme'];
            const results = [];
            
            for (const category of categories) {
                try {
                    const url = `/api/memes?limit=5&category=${category}`;
                    const response = await fetch(url);
                    const data = await response.json();
                    
                    results.push({
                        category: category || 'æ‰€æœ‰åˆ†ç±»',
                        status: response.status,
                        count: data.data ? data.data.length : 0,
                        error: data.error || null
                    });
                    
                } catch (error) {
                    results.push({
                        category: category || 'æ‰€æœ‰åˆ†ç±»',
                        status: 'ERROR',
                        count: 0,
                        error: error.message
                    });
                }
            }
            
            console.log('æ‰€æœ‰åˆ†ç±»æµ‹è¯•ç»“æœ:', results);
            document.getElementById('api-result').innerHTML = `
                <div class="success">
                    <h4>æ‰€æœ‰åˆ†ç±»æµ‹è¯•å®Œæˆ!</h4>
                    <pre>${JSON.stringify(results, null, 2)}</pre>
                </div>
            `;
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåæ˜¾ç¤ºåˆå§‹çŠ¶æ€
        document.addEventListener('DOMContentLoaded', function() {
            console.log('é¡µé¢åŠ è½½å®Œæˆ');
            console.log('åˆå§‹ç­›é€‰å‚æ•°:', {
                category: currentCategory,
                sortBy: currentSortBy,
                limit: currentLimit,
                page: currentPage
            });
        });
    </script>
</body>
</html>
